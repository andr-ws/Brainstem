# Code for an AUC/ROC analysis of brainstem regions

library(pROC)

# Will need to use the corrected values (following linear model confound correction) from regions identified as sig following correction

# sig_regions: pons, brainstem, lSCP, rSCP, lMCP, rMCP

mod_matrix <- read_excel("~/Desktop/CD_Volumetry/Mod_matrix.xlsx", col_names = FALSE)
demographics <- data.frame(sex = mod_matrix[, 1], group = mod_matrix[, 2], etiv = mod_matrix[, 3], age = mod_matrix[, 4], dis_dur = mod_matrix[, 5])
names(demographics) <- c("sex", "group", "age", "dis_dur")

bstem_peduncle_vols <- read_excel("~/Desktop/CD_Volumetry/bstem_peduncle_harm.xlsx", col_names = FALSE)
dat <- t(bstem_peduncle_vols)

pons_c <- dat[,2]
bstem_c <- dat[,5]
lSCP_c <- dat[,6]
rSCP_c <- dat[,7]
lMCP_c <- dat[,8]
rMCP_c <- dat[,9]

regions_c <- list(pons_c = pons_c, bstem_c = bstem_c, lSCP_c = lSCP_c, rSCP = rSCP, lMCP = lMCP, rMCP = rMCP)
correc_regions <- list()

# Class labels (0 = SO)
outcome <- c(0, 0, 0, 0, 1, 1, 1, 0, 0, 1, 0, 0, 0, 1, 0, 1, 1, 1, 0, 1, 1, 1, 0, 0, 1, 0, 1)

for (i in seq_along(regions_c)) {
  y <- regions_c[[i]]
  model_dat <- data.frame(demographics, y)
  model_dat <- t(t(model_dat))
  model_dat <- as.data.frame(model_dat)

  region_model <- lm(y ~ sex + etiv + age + dis_dur, data = data)
  
  region_resid <- region_model$residuals
  
  correc_regions[[i]] <- y + region_resid
  
}

# assuming your dataset is stored in a data frame called "mydata"
# and the target variable is called "target"
# and the predictors are stored in a data frame called "predictors"

# fit logistic regression model on the training data

# obtain predicted scores for the test data

roc_objs <- list()

logit_regions <- list()

predicted_scores <- list()

for (i in seq_along(correc_regions)) {

  logit_model <- glm(outcome ~ correc_regions[[i]], data = correc_regions, family = binomial)
  
  predicted_scores[i] <- predict(logit_model, newdata = logit_regions[i], type = "response")
  
  roc_objs[i] <- roc(outcome, predicted_scores)
 
}

plot(roc_objs[[1]], col = "red", print.thres = "best", main = "ROC Curves and AUC Values for Different Regions")
for (i in 2:length(roc_objs)) {
  plot(roc_objs[[i]], col = i+1, add = TRUE, print.thres = FALSE)
}

legend("bottomright", legend = c("pons_c", "bstem_c", "lSCP_c", "rSCP_c", "lMCP_c", "rMCP_c"), 
       col = 1:length(roc_objs)+1, lwd = 2, cex = 0.8)
 
